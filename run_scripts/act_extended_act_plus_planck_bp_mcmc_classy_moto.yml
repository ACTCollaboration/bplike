debug: False
timing: True
# boss 100mJy
# deep56 15mJy

# Run with bandpass corrections
likelihood:
  # The 100 mJy likelihood

  bplike.act100_act_TT_plus_planck_TT:
    #path: /Users/boris/Work/CLASS-SZ/SO-SZ/bplike/
    stop_at_error: False
    bandpass: True
    # Optional line to do some debugging with an input theory curve
    #theory_debug: data/actpol_2f_full_s1316_2flux_fin/data/cosmo2017_10K_acc3_lensedCls.dat
    # theory_debug: /Users/boris/Work/CLASS-SZ/SO-SZ/bplike/data/bplike_data/cls_model.txt # boris's debug
    # use_act_planck: 'yes'

  # # # The 15 mJy likelihood
  bplike.act15_act_TT_plus_planck_TT:
    stop_at_error: False
    bandpass: True
    # Optional line to do some debugging with an input theory curve
    #theory_debug: data/actpol_2f_full_s1316_2flux_fin/data/cosmo2017_10K_acc3_lensedCls.dat
    # theory_debug: /Users/boris/Work/CLASS-SZ/SO-SZ/bplike/data/bplike_data/cls_model.txt # boris's debug
    # use_act_planck: 'yes'



params:

  theta_MC_100:
    prior:
      min: 0.5
      max: 10
    ref:
      dist: norm
      loc: 1.04109
      scale: 0.0004
    proposal: 0.0002
    latex: 100\theta_\mathrm{MC}
    drop: true
    renames: theta

  100*theta_s:
    value: 'lambda theta_MC_100: theta_MC_100'
    derived: false

  logA:
    prior:
      min: 2
      max: 4
    ref:
      dist: norm
      loc:   3.1
      scale: 0.001
    proposal: 0.001
    drop: True
    latex: \log(10^{10} A_\mathrm{s})


  A_s:
    value: "lambda logA: 1e-10*np.exp(logA)"
    latex: A_\mathrm{s}
  n_s:
    prior:
      min: 0.8
      max: 1.2
    ref:
      dist: norm
      loc:   0.96
      scale: 0.004
    proposal: 0.002
    latex: n_\mathrm{s}
  omega_b:
    prior:
      min: 0.005
      max: 0.1
    ref:
      dist: norm
      loc:   0.0221
      scale: 0.0001
    proposal: 0.0001
    latex: \Omega_\mathrm{b}h^2

  omega_cdm:
    prior:
      min: 0.001
      max: 0.99
    ref:
      dist: norm
      loc:   0.12
      scale: 0.001
    proposal: 0.0005
    latex: \Omega_\mathrm{c}h^2
  tau_reio:
    prior:
      min: 0.01
      max: 0.8
    ref:
      dist: norm
      loc:   0.065
      scale: 0.01
    proposal: 0.005
    latex: \tau_\mathrm{reio}

  H0:
    latex: H_0
  sigma8:
    latex: \sigma_8

  a_tsz: #0.5806115E+01
    latex: a_\mathrm{tSZ}
    prior:
      max: 10
      min: 0
    proposal: 0.2
    ref:
      dist: norm
      loc: 0.5806115E+01
      scale: 0.5


  a_ksz: #0.1024734E-03
    latex: a_\mathrm{kSZ}
    prior:
      max: 10
      min: 0
    proposal: 0.5
    ref:
      dist: norm
      loc: 0.1024734E-03
      scale: 0.5


  xi: #0.1998220E+00
    latex: \xi^{tSZ-CIB}
    prior:
      max: 0.2
      min: 0
    proposal: 0.05
    ref:
      dist: norm
      loc: 0.1998220E+00
      scale: 0.05

  a_d: #0.6872966E+01
    latex: a_\mathrm{d}
    prior:
      max: 11
      min: 0
    proposal: 1
    ref:
      dist: norm
      loc: 0.6872966E+01
      scale: 1

  a_c:
    latex: a_\mathrm{c}
    prior:
      max: 15
      min: 0
    proposal: 1
    ref:
      dist: norm
      loc: 4.9
      scale: 1

  beta_CIB: #0.2447908E+01
    latex: \beta_c
    prior:
      max: 5
      min: 0
    proposal: 0.2
    ref:
      dist: norm
      loc: 2.2
      scale: 0.5


  a_p_tt_15:  #0.3682240E+01
    latex: a_\mathrm{p,TT,15}
    prior:
      max: 6
      min: 0
    proposal: 0.4
    ref:
      dist: norm
      loc: 3.1
      scale: 0.5

  a_p_tt_100: #0.2249012E+02
    latex: a_\mathrm{p,TT,100}
    prior:
      max: 40
      min: 0.0
    proposal: 3
    ref:
      dist: norm
      loc: 22.5
      scale: 6

  a_g_tt_15: #0.2811710E+01
    latex: a_g_tt_15
    prior:
      max: 5
      min: 0.0
    proposal: 0.4
    ref:
      dist: norm
      loc: 0.2811710E+01
      scale: 0.4

  a_g_tt_100: #0.8717251E+01
    latex: a_g_tt_100
    prior:
      max: 20.
      min: 0.0
    proposal: 0.3
    ref:
      dist: norm
      loc: 0.8717251E+01
      scale: 0.3
  #
  # a_g_te_15: #0.1049940E+00
  #   latex: a_g_te_15
  #   prior:
  #     max: 11
  #     min: 0.0
  #   proposal: 0.1
  #   ref:
  #     dist: norm
  #     loc: 0.1049940E+00
  #     scale: 0.1
  #
  # a_g_te_100: #0.3559930E+00
  #   latex: a_g_te_100
  #   prior:
  #     max: 11
  #     min: 0.0
  #   proposal: 0.04
  #   ref:
  #     dist: norm
  #     loc: 0.3559930E+00
  #     scale: 0.04
  #
  #
  # a_g_ee_15: #0.3436806E-01
  #   latex: a_g_ee_15
  #   prior:
  #     max: 5.
  #     min: 0.0
  #   proposal: 0.08
  #   ref:
  #     dist: norm
  #     loc: 0.3436806E-01
  #     scale: 0.03
  #
  # a_g_ee_100: #0.1293905E+00
  #   latex: a_g_ee_100
  #   prior:
  #     max: 11
  #     min: 0.0
  #   proposal: 0.03
  #   ref:
  #     dist: norm
  #     loc: 0.1293905E+00
  #     scale: 0.03
  #
  #
  # a_p_te: #0.4443353E-01
  #   latex: a_\mathrm{p,TE}
  #   prior:
  #     max: 1
  #     min: -1
  #   proposal: 0.05
  #   ref:
  #     dist: norm
  #     loc: 0.4443353E-01
  #     scale: 0.06
  #
  # a_p_ee: #0.5342375E-04
  #   latex: a_\mathrm{p,EE}
  #   prior:
  #     max: 5
  #     min: 0
  #   proposal: 0.08
  #   ref:
  #     dist: norm
  #     loc: 0.5342375E-04
  #     scale: 0.1
  #
  # a_s_ee: 0.
  #   # latex: a_s_ee
  #   # prior:
  #   #   max: 1.1
  #   #   min: 0.0
  #   # proposal: 0.01
  #   # ref:
  #   #   dist: norm
  #   #   loc: 1
  #   #   scale: 0.02
  # a_s_te: 0.
    # latex: a_s_te
    # prior:
    #   max: 1.1
    #   min: 0.0
    # proposal: 0.01
    # ref:
    #   dist: norm
    #   loc: 1
    #   scale: 0.02
  cal_150: 1.
    # latex: c_{150}
    # prior:
    #   max: 11
    #   min: 0.0
    # proposal: 0.01
    # ref:
    #   dist: norm
    #   loc: 1
    #   scale: 0.02
  cal_090: 1.
    # latex: c_{95}
    # prior:
    #   max: 11
    #   min: 0.0
    # proposal: 0.01
    # ref:
    #   dist: norm
    #   loc: 1
    #   scale: 0.02
    #   scale: 0.02
  cal_100: 1.
    # latex: c_{95}
    # prior:
    #   max: 11
    #   min: 0.0
    # proposal: 0.01
    # ref:
    #   dist: norm
    #   loc: 1
    #   scale: 0.02
  cal_143: 1.
    # latex: c_{95}
    # prior:
    #   max: 11
    #   min: 0.0
    # proposal: 0.01
    # ref:
    #   dist: norm
    #   loc: 1
    #   scale: 0.02
  cal_217: 1.
    # latex: c_{95}
    # prior:
    #   max: 11
    #   min: 0.0
    # proposal: 0.01
    # ref:
    #   dist: norm
    #   loc: 1
    #   scale: 0.02
  cal_353: 1.
    # latex: c_{95}
    # prior:
    #   max: 11
    #   min: 0.0
    # proposal: 0.01
    # ref:
    #   dist: norm
    #   loc: 1
    #   scale: 0.02
  cal_545: 1.
    # latex: c_{95}
    # prior:
    #   max: 11
    #   min: 0.0
    # proposal: 0.01
    # ref:
    #   dist: norm
    #   loc: 1
    #   scale: 0.02



prior:
  tau_reio_prior: "lambda tau_reio: stats.norm.logpdf(tau_reio, loc=0.065, scale=0.015)"
  a_c_prior: "lambda a_c: stats.norm.logpdf(a_c, loc=4.9, scale=0.9)"
  # a_p_tt_100_prior: "lambda a_p_tt_100: stats.norm.logpdf(a_p_tt_100, loc=22.5, scale=3.0)"
  a_p_tt_15_prior: "lambda a_p_tt_15: stats.norm.logpdf(a_p_tt_15, loc=3.1, scale=0.4)"
  a_g_tt_15_prior: "lambda a_g_tt_15: stats.norm.logpdf(a_g_tt_15, loc=2.79, scale=0.45)"
  a_g_tt_100_prior: "lambda a_g_tt_100: stats.norm.logpdf(a_g_tt_100, loc=8.77, scale=0.30)"
  # a_g_te_15_prior: "lambda a_g_te_15: stats.norm.logpdf(a_g_te_15, loc=0.11, scale=0.1)"
  # a_g_te_100_prior: "lambda a_g_te_100: stats.norm.logpdf(a_g_te_100, loc=0.36, scale=0.04)"
  # a_g_ee_15_prior: "lambda a_g_ee_15: stats.norm.logpdf(a_g_ee_15, loc=0.04, scale=0.08)"
  # a_g_ee_100_prior: "lambda a_g_ee_100: stats.norm.logpdf(a_g_ee_100, loc=0.13, scale=0.03)"

theory:
  classy:
    path: /moto/home/bb3028/class_public
    extra_args:
      # non linear: halofit
      # k_min_tau0 : 0.002
      # k_max_tau0_over_l_max : 3.
      # k_step_sub : 0.015
      # k_step_super : 0.0001
      # k_step_super_reduction : 0.1

      perturbations_verbose: 0
      thermodynamics_verbose: 0
      background_verbose: 0
      harmonic_verbose: 0
      fourier_verbose : 0
      input_verbose : 0
      lensing_verbose : 0
      # The base model features two massless
      # and one massive neutrino with m=0.06eV.
      # The settings below ensures that Neff=3.046
      # and m/omega = 93.14 eV
      N_ur : 2.0328
      N_ncdm : 1
      m_ncdm : 0.06
      T_ncdm : 0.71611
      YHe: 'BBN'

sampler:
  # Example for evaluating at a specific point
  # evaluate:
  #   override:
  #     theta_MC_100: 1.045
  #     logA: 3.05
  #     ns : 0.956159
  #     ombh2 : 0.022219
  #     omch2 : 0.119883
  #     tau : 0.0754047
  #
  #     # foreground paramateres
  #     a_tsz:    0.5806115E+01 ##3.3 OK CHECKED
  #     a_ksz:   0.1024734E-03 #4.950210 OK CHECKED
  #     xi:   0.1998220E+00 #1.654936e-2 OK CHECKED
  #     a_d:   0.6872966E+01 #6.9 OK CHECKED
  #     a_p_tt_15:   0.3682240E+01 #3.1
  #     a_p_tt_100:   0.2249012E+02 #24.6
  #     a_c:    0.3648102E+01 #4.9 OK CHECKED
  #
  #     a_p_te:   0.4443353E-01 # 0.1
  #     a_p_ee:    0.5342375E-04 # 0.0
  #
  #     a_g_tt_15: 0.2811710E+01  #0.3436806E-01 #0
  #     a_g_tt_100:  0.8717251E+01 #0.2811710E+01  #0.3436806E-01 #0
  #
  #     a_g_te_15: 0.1049940E+00 #0.1049940E+00 # 0
  #     a_g_te_100: 0.3559930E+00 #0.1049940E+00 # 0
  #     a_g_ee_15:  0.3436806E-01 #0.3436806E-01 #0
  #     a_g_ee_100:  0.1293905E+00 #0.3436806E-01 #0
  #
  #     a_s_te: 0.
  #     a_s_ee: 0.
  #
  #     beta_CIB : 0.2447908E+01 #2.2 OK CHECKED
  #     # for the act only lkl
  #     yp_95: 0.9860632E+00  #OK CHECKED
  #     yp_150: 0.9714017E+00 #OK CHECKED
  #
  #
  #
  #
  #
  #
  #     cal_95: 1.
  #     cal_150: 1.
  #
  #     leak_95: 1.
  #     leak_150: 1.

  # Example MCMC run
  mcmc:
    burn_in: 100
    max_samples: .inf
    max_tries: 400
    learn_proposal: True
    drag: True
    Rminus1_stop: 0.001
    # Optionally use a covmat with the right theta convention
    # covmat: 'data/ACTPol_b5_new_cosmomc_theta2.covmat'

  # Example for running the minimizer
  # minimize:
  #   covmat: 'data/ACTPol_b5_new_cosmomc_theta2.covmat'


output: /moto/home/bb3028/atsz_analysis/act_extended_act_plus_planck_bp
resume: True
